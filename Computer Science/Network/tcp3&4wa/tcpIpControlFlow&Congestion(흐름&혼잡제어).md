## TCP를 배우기 전에
#### 🔗전송계층이란?
<img width="274" alt="스크린샷 2022-08-29 오후 12 23 15" src="https://user-images.githubusercontent.com/66079439/187117830-728442b3-1253-4a7c-baa5-dbc5435f425b.png">

  - 컴퓨터 처리와 전자 통신에서 전송 계층(Transport layer)은 계층 구조의 네트워크 구성요소와 프로토콜 내에서 송신자와 수신자를 연결하는 통신 서비스를 제공한다.
  - 전송 계층은 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어, 그리고 다중화와 같은 편리한 서비스를 제공한다.
  - 전송 계층은 인터넷의 기반인 TCP/IP 참조 모델과 일반적인 네트워크 모델인 개방형 시스템 간 상호 접속 (Open Systems Interconnection, OSI) 모두 포함하고 있다.
  - 전송 프로토콜 중 가장 잘 알려진 것은 연결 지향 전송 방식을 사용하는 전송 제어 프로토콜(TCP)이다. 보다 단순한 전송에 사용되는 사용자 데이터그램 프로토콜(UDP)도 있다.

#### "한 마디로 정의하자면 End Point 간 신뢰성 있는 데이터 전송을 담당하는 계층이다!"

<img width="643" alt="Transport Layer" src="https://user-images.githubusercontent.com/66079439/187117914-c61f3008-6ae2-403c-af30-53836d12e76b.png">

#### 🔗전송 계층이 없다면?
  - 데이터의 순차 전송이 원활히 이루어지지 않는다.
  - Flow(흐름문제) -> 송수신자 간의 데이터 처리 속도 차이
  - Congestion(혼잡문제) -> 네트워크의 데이터 처리 속도 (ex. 라우터)


## TCP로 넘어가보자

### ✔️TCP(Transmission Control Protocol)란 무엇일까?
#### 컴퓨터가 다른 컴퓨터와 데이터 통신을 하기 위한 규약(프로토콜)의 일종이다. 한국어로 번역하면 전송 제어 프로토콜. TCP는 세계 통신표준으로 개발된 OSI 모형에서 4번째 계층인 전송 계층(Transport Layer)에서 사용하는 규약으로, 보통 하위 계층에서 사용하는 IP와 엮어서 TCP/IP로 표현하는 경우가 많다. 동일 계층에서 사용하는 또 다른 프로토콜로 UDP가 존재한다.

### ✔️왜 TCP가 개발되었을까?
##### TCP의 개발 동기는 군사적인 목적과도 닿아있다. 미국 국방부 산하의 고등 연구국에서 ARPANET을 연구할 때 관심을 가진 주제가 적국의 폭격, 심지어 핵전쟁이 발발하더라도 죽지 않고 정상적으로 동작하는 네트워크였다. 당시 일반적으로 사용되던 통신방식은 회선교환(Circuit Switching) 방식이었다. 예를 들어 서울에서 부산으로 간다고 할 때 미리 이동할 경로를 "경부고속도로만 이용한다"로 정해놓는 방식이다. 이러한 방식은 통신을 중계해 주던 곳이 개박살나거나 중간에 선 하나가 단락되는 것만으로도 통신이 바로 끊어지는 상황이 벌어졌다.

##### 이에 따라 사용된 것이 패킷교환(Packet Switching) 방식인데, 앞서의 사례와는 달리 경로가 정해져 있지 않다. 경부고속도로가 심하게 막히면 다른 고속도로나 국도로 우회를 해서 갈 수 있는 방식이다. 따라서 서로 연결이 가능한 회선 하나만 남아있어도 통신이 끊어지지 않고 계속될 수 있는 환경을 구축하게 된 셈이었다. 다만 이 방식은 어떻게든 통신을 유지하는 것이 목적이므로 네트워크 환경의 안정성은 떨어질 수밖에 없었다. 이로 인해 중간에 데이터가 유실되거나, 너무 늦게 전달되는 등 신뢰성이 떨어지는 문제점이 있었다. 이러한 문제점들을 해결하고자 신뢰성을 보장할 수 있는 통신 규약을 연구하게 됐고, 이에 따라 나온 것이 TCP이다.

### ✔️TCP의 특징
  - 3Way Handshake, 4Way Handshake 기능을 통해 통신을 연결하고 종료할 수 있다.(3way 내용 참고)  
 
  - 신뢰성 보장과 흐름 제어(Flow Control)
      - 연결설정을 통해 통신 준비를 마치면 서로 데이터를 주고 받을 수 있다.
      - 다만 네트워크를 통해서 한 번에 보낼 수 있는 데이터의 양은 제한이 되어 있으므로 분할해서 보내야 된다.
      - 분할된 데이터에는 고유번호가 부여된다.
      - 이를 바탕으로 데이터 수신, 발신자 모두 데이터의 정보를 알 수 있다.
      - 또한 데이터의 고유번호를 알고 있기 때문에 데이터가 제대로 왔는지 안왔는지 신뢰성을 확인할 수 있다.
      - 서버에서 수신할 수 있는 자료양 혹은 클라이언트가 서버로부터 수신할 수 있는 자료양 등을 서로 알려준느 방식을 통해 효율적으로 데이터 전송이 가능하다.
      - 이를 위해 TCP의 헤더파일을 살펴보면 목적지주소, 확인 응답, 오류검출및복원, 실제데이터 등이 포함된다.
      - 따라서 이 과정을 전부 이행하기 위해 신뢰성은 높지만 수신속도가 떨어진다는 단점을 지닌다.  
     
  - 혼잡 제어(Congestion Control)
      - 초기 TCP에는 없던 요소이다. 한정된 네트워크 대역폭에서 사용자가 점점 늘어나다 보니 네트워크 회선이 그 부하를 감당하지 못하고 사망하는 일들이 발생했다.
      - 부하가 발생하는 예시는 다음과 같다.
      - 송신자 A: '이상하네, 벌써 'ABC'를 보낸지 한참 됐는데 왜 받았다는 연락이 안올까?. 한 번 더 보내야겠다.
      - 송신자 B: '이상하네, 벌써 'ABC'를 보낸지 한참 됐는데 왜 받았다는 연락이 안올까?. 한 번 더 보내야겠다.
      - 송신자 C: '이상하네, 벌써 'ABC'를 보낸지 한참 됐는데 왜 받았다는 연락이 안올까?. 한 번 더 보내야겠다.
      - 여기서 A, B, C는 라우터로 송신하는 사람들이다. 이미 라우터에는 아직 라우터가 미처 다 송신하지 못한 A, B, C의 데이터들이 남아있다. 그런데 A,B,C가 각각 데이터를 또 보낸다. 이것은 두 가지 문제가 있다.
          - 라우터의 저장에도 한계 용량이 있다. 라우터 내의 저장 공간에 저장되지 못한 데이터들은 손실된다.
          - 데이터에 대한 답신이 없으면 또 같은 데이터에 대한 요청을 보낸다. 만약 라우터가 무한한 저장공간을 가진다는 가정하에라도, 결국 라우터에 쌓여가는 데이터들 때문에 사용되는 전력이 비효율적이다.
      - 그래서 이를 제어하기 위한 방법이 1980년대에 추가됐다.
          - 단순한 예로 통신을 시작할 때 일단 보내는 쪽에서 30~35쪽까지 자료를 보내본다.
          - 그래서 상대가 잘 받았으면 이후 보내는 양을 조금씩 늘려보는 방식을 취한다.
          - 그러다가 상대가 데이터를 제대로 받지 못한 것이 확인되면 그 즉시 보내는 양을 확 줄인다.
          - 그리고 다시 슬금슬금 보내는 양을 늘렸다가 또 못 받았으면 줄여버리는 형태로 보내는 양을 조절하게 된다.
          - 보내는 양을 늘리고 줄이는 방법은 AIMD(Additive Increase/Multiplicative Decrease)를 채택하고 있으나 구체적으로 적용되는 방식은 TCP 버전마다 약간씩 차이가 있다.
          - 이 방법은 버스트(burst)를 줄이기 위한 것이다.
          - 깨진 독에 어떻게 물이 차오르기 시작하는지를 생각해보면 어렵지 않다.
          - 어느 순간에 빠지는 속도보다 들어오는 속도가 커지는 순간이다. 이것을 버스트라고 부르는데, 요점은 버스트가 나지 않으면 물이 차오르기 시작할 일도 없다는 것이고, 버스트가 발생해서 물이 차오르기 시작했다면 일단 물이 다 빠진 다음에 물을 부으면 되겠다는 생각이다.
          - 이를 네트워크 환경에 맞추어 해석하면, 처음에 버스트가 생기지 않을 적절한 양을 보내고, 버스트가 일어나 라우터에 낱장들이 쌓이기 시작하는 것이 의심된다면 일단 라우터에서 그 낱장들이 빠지는 것을 기다린다는 방법이 되는 것이다.
      - 위 방법을 통해 TCP로 통신하는 모든 사용자들이 네트워크 상황에 따라 속도를 조절할 수 있게 되었으며, 많은 사용자들이 동시에 통신을 시도하면 속도에서 손해를 보게 되지만 죽지는 않게 만들었다. 이론적으로 100 Mbps 회선에서 5명의 사람이 동시에 TCP로 통신을 시도하면 초반에는 서로 차이가 있지만 궁극적으로는 100 Mbps 회선을 각각 20 Mbps씩 공평하게 나눠 가지는 효과를 얻게 된다.  
  
### ✔️TCP/IP 계층에 대해서
  - TCP/IP는 통신 규칙의 모음이며, 프로토콜 스위트라고 부르기도 한다.
  - TCP/IP의 4계층은 이러한 규칙이나 프로토콜이 적용되는 특정한 조건을 의미한다.
  - 이 시스템은 TCP/IP 모델이 다양한 기기와 앱에서 효율적으로 ‘통신’하고 데이터를 전송할 수 있도록 하는 방식이다.

#### 응용 계층
  - 응용 계층 (Application Layer) 프로토콜은 TCP/IP 프로토콜 (TCP IP protocol)의 범위에 포함되어있다.
  - 이러한 프로토콜은 앱에 구축되기 때문에 사용자가 상호작용하기 가장 쉬운 계층이다.
  - 응용 계층은 사용자 (사람 또는 소프트웨어)가 네트워크에 접근할 수 있도록 한다. 게다가, 사용자 인터페이스를 제공할 뿐만 아니라 이메일, 원격 파일 접근 및 전송, 공유 데이터베이스 관리 등의 서비스를 제공한다.
  - 메일 프로그램에서는 인터넷에서 전자우편을 보낼 때 이용하게 되는 표준 통신 규약인 SMPT (Simple Mail Transfer Protocol)를 이용한다.
  - 인터넷 브라우저는 웹 서버와 사용자의 인터넷 브라우저 사이에 문서를 전송하기 위해 사용되는 통신 규약인 HTTP (Hypertext Transfer Protocol) 등을 이용한다.
  - 이외에도 흔히 이용되는 응용 계층 프로토콜로는 파일 전송 규약 (File Transfer Protocol: FTP), 동적 호스트 설정 통신 규약 (Dynamic host Configuration protocol: DHCP), 간이 망 관리 프로토콜(Simple Network Management Protocol: SNMP) 등이 있다.

#### 전송 계층
  - 전송 계층은 전송을 담당하는 계층이다.
  - 전송 계층에는 TCP뿐만 아니라 사용자 데이터그램 통신 규약(User Datagram Protocol: UDP)도 있다.
  - UDP는 TCP보다 단순하며 다른 데이터에 비해 안전하게 보호되어야 할 필요가 없는 실시간 응용 프로그램에서 흔히 이용된다.
  - UDP는 TCP보다 신뢰도가 낮고 오류 검출, 흐름 제어 등의 기능을 제공하지 않아 패킷을 빠르게 전송하는 응용 계층에서 이용되고있다.
  - TCP는 두 네트워크 사이에 연결을 형성하고 효율적인 작업을 위해 데이터를 작은 패킷으로 나눠서 데이터를 전송한다. TCP는 연결형 서비스이지만, UDP는 비연결형 서비스이다.
  - TCP는 신뢰도가 높지만 속도가 느리고, 이에 비해서 UDP는 신뢰도가 낮지만 속도가 빠르다. TCP의 패킷 교환 방식은 가상 회선 방식인 반면, 반면에 UDP는 데이터그램 방식을 따르고 있다. TCP에서는 전송 순서를 보장하지만 UDP의 경우 전송 순서가 바뀔 수 있다.
 
#### 인터넷 계층
  - 인터넷 계층 (Internet Layer) 프로토콜에는 IP뿐만 아니라 주소 변환 규약(Address Resolution Protocol: ARP), 인터넷 그룹 관리 프로토콜(Internet Group Management Protocol: IGMP), 인터넷 제어 메시지 프로토콜 (Internet Control Message Protocol: ICMP)도 있다.
  - 인터넷 계층은 네트워크 간 데이터 패킷의 전송을 관리한다.
  - 여기서 ARP는 네트워크 계층 주소와 링크 계층 주소 사이의 변환을 담당하는 프로토콜이며, IGMP는 그룹 멤버십을 구성하거나, 그룹 관리를 위한 프로토콜이며, ICMP는 인터넷 통신 서비스 환경에서 오류에 대한 알림과 관련된 메시지를 전달하는 목적의 프로토콜이다.

#### 데이터 링크 계층
  - 데이터 링크 계층 (Datalink Layer)은 데이터 전송의 최하위 계층으로, 네트워크 인터페이스 계층(Network Interface Layer)이라고도 부른다.
  - 이 계층에서 하는 일은 데이터가 원하는 IP 주소 (즉, 공유기)에 도달할 뿐만 아니라 해당 네트워크 내의 연결된 기기에 연결되어 있는지 확인하는 역할이다.
  - 데이터 링크 계층은 원하는 기기의 MAC 주소를 확인하고 이더넷 케이블 및 와이파이를 통한 데이터 전송을 관리하는 등의 작업을 담당한다.
  





## Reference
  - https://ko.wikipedia.org/wiki/%EC%A0%84%EC%86%A1_%EA%B3%84%EC%B8%B5
  - https://namu.wiki/w/TCP
  - https://www.youtube.com/watch?v=ikDVGYp5dhg
