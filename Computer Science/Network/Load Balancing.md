//220830 Noel

<br/>
<br/>
<br/>

# ❤️ 로드 밸런싱(Load Balancing)

> 둘 이상의 CPU or 저장장치와 같은 컴퓨터 자원들에게 작업을 나누는 것

<br/>

#### 🧡 로드 밸런싱의 필요성<br/>

- 현대의 모든 정보는 인터넷을 통해 연결되어있음<br/>
- 인터넷의 발달은 데이터 통신을 활발하게 많음 -> **트래픽의 폭팔적인 증가**로 이어짐<br/>
- 그 결과 아무리 성능이 뛰어난 서버라고해도 모든 트래픽을 감당할 수 없음<br/>
- 따라서 기업들은 **여러대의 서버에 동일한 데이터를 저장해 수많은 트래픽을 효과적으로 분산**<br/>
- 이떄 **쏟아지는 트래픽을 여러 대의 서버로 분산해 주는것이 로드 밸런싱!<br/>**

``` 참고
💡이해를 위한 용어 설명

트래픽이란?
- 서버와 스위치 등의 네트워크 장치에서 일정시간 흐르는 데이터 양
- 웹사이트에 트래픽이 많다는것은 사용자 접속이 많아 전송하는 데이터 양이 많다는 의미
- 트래픽이 너무 많으면 서버에 과부하가 걸려 기능에 문제가 생실 수 있음
- 예) 홈페이지를 인터넷 브라우저에 띄우기 위해 
			-> 서버에 파일을 올려놓고 사용자가 웹페이지에 접속 할때마다 필요한 정보를 다운로드 해야하는데
			-> 여기서 다운로드 되는 정보의 양이 바로 트래픽!
			-> 홈페이지에서 여러페이지를 보거나 이미지, 동영상을 내 컴으로 받을때 홈페이지와 연결된 트래픽의 양이 증가함
```

<br/>

<br/>

<hr/>

#### 🧡 증가한 트래픽에 대처하는 방법

<img width="790" alt="image" src="https://user-images.githubusercontent.com/103012104/187400793-dbc0fd3f-12fa-433b-ad77-cad20a5a352a.png">

**Scale-up<br/>**

- **서버 자체의 성능을 올리는 것**<br/>
-  비유하자면 CPU가 i3인 컴퓨터를 i7으로 **업그레이드**하는 것과 비슷<br/>

<br/>

 **Scale-out<br/>**

- 기존 서버와 동일하거나 낮은 성능의 서버를 **두 대 이상 증설하여 운영하는 것**<br/>
-  CPU가 i3인 컴퓨터를 **여러 대 추가 구입해 운영**하 것과 비슷<br/>
- **Scale-out**의 방식으로 서버를 증설한다면, 여러 대의 서버로 트래픽을 균등하게 분산해주는 **로드밸런싱**이 반드시 필요<br/>

<br/>

<br/>

<hr/>

#### 🧡로드 밸런싱 이란?<br/>

<img width="781" alt="image" src="https://user-images.githubusercontent.com/103012104/187400892-5d970ab9-a889-45f6-8342-1ff5c6190bb1.png">

- 로드 밸런싱은 **여러 대의 서버를 두고 서비스를 제공하는 분산처리 시스템에서 필요한 기술**<br/>
- 분산식 웹 서비스로, **여러 서버에 부하(Load)를 나누어주는 역할**<br/>
- 로드밸런서(Load Balancer)를 **Client와 Server Pool 사이에 위치에 두고, 부하기 일어나지 않도록 트래픽을 여러 서버에 분산**<br/>
- 서비스를 운영하는 사이트의 규모에 따라 웹 서버를 추가로 증설하면서 로드 밸런서로 관리해주면 웹 서버의 부하를 해결할 수 있다.

```참고
💡이해를 위한 용어 설명

로드 벨런서 (Load Balancer)
- 서버에 가해지는 부하(=load)를 분산(=balancing)해주는 장치 또는 기술을 통칭

서버 풀 (Sever Pool) 
- 분산 네트워크를 구성하는 서버들의 그룹
```

<br/>

<br/>

<hr/>

#### 🧡 다양한 부하 분산 방식(로드밸런싱 알고리즘)

- 클라이언트의 요청을 특정 서버에 분배하는 로드밸런싱 기법은 여러 가지가 있음
-  활용할 수 있는 부하 분산 방식(로드밸런싱 알고리즘)에 어떠한 것들이 있는지 알아보겠습니다.

| 구분                                                       | 내용                                                         |
| ---------------------------------------------------------- | ------------------------------------------------------------ |
| **라운드로빈 방식<br/>(Round Robin Method)**               | - 서버에 들어온 요청을 순서대로 돌아가며 배정하는 방식 <br/> - 클라이언트의 요청을 순서대로 분배하기 때문에 여러 대의 서버가 동일한 스펙을 갖고 있고, 서버와의 연결(세션)이 오래 지속되지 않는 경우에 활용하기 적합 |
| **가중 라운드로빈 방식<br/>(Weighted Round Robin Method)** | - 각각의 서버마다 가중치를 매기고 가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분<br/>- 주로 서버의 트래픽 처리 능력이 상이한 경우 사용되는 부하 분산 방식.<br/>- 예) A 서버 (가중치:5) /  B 서버가 (가중치:2) 일 때,<br/>       > 로드밸런서는 라운드로빈 방식으로 A 서버에 5개 B 서버에 2개의 요청을 전달 |
| **IP 해시 방식<br/>(IP Hash Method)**                      | - 클라이언트의 IP 주소를 특정 서버로 매핑하여 요청을 처리하는 방식,<br/>- 사용자의 IP를 해싱해 Load를 분배하기 때문에 사용자가 항상 동일한 서버로 연결되는 것을 보장<br/><br/>*해싱(Hashing) : 임의의 길이를 지닌 데이터를 고정된 길이의 데이터로 매핑하는 것, 또는 그러한 함수 |
| **최소 연결 방식<br/>(Least Connection Method)**           | - 요청이 들어온 시점에 가장 적은 연결상태를 보이는 서버에 우선적으로 트래픽을 배분<br/>-자주 세션이 길어지거나, 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합한 방식 |
| **최소 리스폰타임<br/>(Least Response Time Method)**       | - 서버의 현재 연결 상태와 응답시간을 모두 고려하여 트래픽을 배분<br/>- 가장 적은 연결 상태와 가장 짧은 응답시간을 보이는 서버에 우선적으로 Load를 배분하는 방식<br/><br/>*응답시간 (Response Time) : 서버에 요청을 보내고 최초 응답을 받을 때까지 소요되는 시간 |

<br/>

<br/>

<hr/>

#### 🧡 L4 로드밸런싱과 L7 로드밸런싱

- 부하 분산에는 **L4 로드밸런서와 L7 로드밸런서가 가장 많이 활용**
- L4 로드밸런서부터 **포트(Port)정보를 바탕으로 로드를 분산하는 것이 가능**하기 때문
- **한 대의 서버에 각기 다른 포트 번호를 부여하여 다수의 서버 프로그램을 운영하는 경우라면 최소 L4 로드밸런서 이상을 사용**

```참고
💡이해를 위한 용어 설명

L4? L7?
- 네트워크 통신 시스템은 크게 일곱 가지의 계층(OSI 7 layers)로 나뉨
- 각각의 계층(Layer)이 L1/L2/L3‥‥L7에 해당
- 상위 계층에서 사용되는 장비는 하위 계층의 장비가 갖고 있는 기능을 모두 가지고 있으며, 상위 계층으로 갈수록 더욱 정교한 로드밸런싱이 가능
```

<br/>

##### 💚 L4 로드밸런싱

<img width="795" alt="image" src="https://user-images.githubusercontent.com/103012104/187400965-cfbbc79a-d5ac-4bfe-952b-11df7d21f049.png">

- L4 로드밸런서는 네트워크 계층(IP, IPX)이나 트랜스포트 계층(TCP, UDP)의 정보를 바탕으로 로드를 분산
-  IP주소나 포트번호, MAC주소, 전송 프로토콜에 따라 트래픽을 나누는 것이 가능

<br/>

##### 💚 L7 로드밸런싱

<img width="796" alt="image" src="https://user-images.githubusercontent.com/103012104/187400999-99984adc-429e-45f7-9cf5-9a85d74d7a77.png">

- L7 로드밸런서의 경우 애플리케이션 계층(HTTP, FTP, SMTP)에서 로드를 분산하기 때문에 HTTP 헤더, 쿠키 등과 같은 **사용자의 요청을 기준으로 특정 서버에 트래픽을 분산**하는 것이 가능
- 쉽게 말해 **패킷의 내용을 확인하고 그 내용에 따라 로드를 특정 서버에 분배**하는 것이 가능
-  위 그림과 같이 URL에 따라 부하를 분산시키거나, HTTP 헤더의 쿠키값에 따라 부하를 분산하는 등 **클라이언트의 요청을 보다 세분화해 서버에 전달 가능**
-  또한 L7 로드밸런서의 경우 **특정한 패턴을 지닌 바이러스를 감지해 네트워크를 보호**할 수 있으며, **DoS/DDoS와 같은 비정상적인 트래픽을 필터링할 수 있어 네트워크 보안 분야에서도 활용**



#####  L4 로드밸런서와 L7 로드밸런서 비교

|               | L4 로드밸런서                                                | L7 로드밸런서                                                |
| ------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 네트워크 계층 | 4계층 전송 계층 <br/>(Transport Layer)                       | 7계층 응용 계층  <br/>(Application Layer)                    |
| 특징          | TCP/UDP 포트정보를 바탕으로 함                               | TCP/UDP 포트정보는 <br/> 물론 HTTP의 URL, <br/> FTP의 파일명, <br/>쿠키정보 등을 바탕으로 함 |
| 장점          | - 데이터 안을 들여다보지 않고 패킷 레벨에서만 로드를 분산하기 때문에 속도가 빠르고 효율이 높음<br/>-데이터의 내용을 복호화할 필요가 없기 떄문에 안전함<br/><br/>* 복호화(decryption) : 부호화(암호문)된 데이터를 부호되기 전 형태로 바꿔 사람이 읽을 수 있는 형태로 되돌리는 것 | - 상위계층에서 로드를 분사한기떄문에 더 섬세한 라우팅이 가능<br/>-캐싱 기능을 제공<br/>-비정상적인 트래픽을 사전에 필터링할 수 있어 서비스 안전성이 높음 |
| 단점          | - 패킷의 내용을 살펴 볼 수 없기 때문에 섬세한 라우팅이 불가능<br/>-사용자의 IP가 수시로 바뀌는 경우라면 연속적인 서비스를 제공하기 어려움 | -페킷의 내용을 복호화 해야하기에 더 높은 비용을 지불해야함<br/>-클라이언트가 로드밸런서와 인증서를 공유해야하기 떄문에 공격자가 로드밸런서를 통해 클라이언트에 데이터에 접근할 보안 상의 위험성이 존잽 |

<br/>

<br/>

<hr/>

출처

https://m.post.naver.com/viewer/postView.naver?volumeNo=27046347&memberNo=2521903

https://github.com/gyoogle/tech-interview-for-developer/blob/master/Computer%20Science/Network/%EB%A1%9C%EB%93%9C%20%EB%B0%B8%EB%9F%B0%EC%8B%B1(Load%20Balancing).md

